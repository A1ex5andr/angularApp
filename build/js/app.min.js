var app = angular.module('store', [
	'ngRoute',
	'catalog',
	'store-gallery',
	'store-panel',
	'contact',
	'scopeTest',
	'cart'
]);

app.config(['$routeProvider', function ($routeProvider) {
	$routeProvider
		// Home
		.when("/", {templateUrl: "layout/home.html", controller: "PageCtrl"})

		// main page modules
		.when("/catalog", {templateUrl: "layout/catalog.html" })
		.when("/contact", {templateUrl: "layout/contact.html" })
		.when("/cart", {templateUrl: "layout/cart.html" })
		.when("/test", {templateUrl: "layout/test.html" })

		// else 404
		.otherwise({ redirectTo: "/404", templateUrl: "layout/404.html" })
}]);

app.controller('PageCtrl', ['$log', function ($log/* $scope, $location, $http */) {
	$log.info("Page Controller reporting on duty.");
}]);


app.service('productService', function() {

    var productList = [];

    var addProduct = function(obj) {
        productList.push(obj);
    };

    // TODO create a callback func
    var getProducts = function(){
        return productList;
    };

    var removeProduct = function(index) {
        productList.splice(index, 1);
    };

    return {
        addProduct: addProduct,
        getProducts: getProducts,
        removeProduct: removeProduct
    };
});
app.factory('getProductsJson', ['$http', function ($http) {
        return $http.get('products.json');
}]);

(function () {

    var app = angular.module('cart', []);

    app.controller('CartCtrl', function ($scope, productService) {
            $scope.products = productService.getProducts();
            this.products = $scope.products;
            this.qty = 1;

            console.log(this.products.length);

            this.getCount = function() {
                return this.products.length;
            };

            this.removeItem = function(index) {
                productService.removeProduct(index);
            };
        });
}());
(function () {

    var app = angular.module('catalog', []);

    app.controller('CatalogController', function (getProductsJson) {
        var store = this;
        store.products = [];
        getProductsJson.success(function (data) {
            store.products = data;
        });
    });

}());


(function () {
   angular.module('contact', [])
       .controller('ContactCtrl', function () {
           // Activates Tooltips for Social Links
           $('.tooltip-social').tooltip({
               selector: "a[data-toggle=tooltip]"
           });
       });
}());
angular.module('scopeTest', [])

    .controller('FirstCtrl', function () {

    }).controller('SecondCtrl', function () {

});


(function () {
    var app = angular.module('store-gallery', []);
    app.directive('productGallery', function () {
        return{
            restrict: 'A',
            templateUrl: 'layout/product-gallery.html',
            controller: function () {
                this.pic = 1;
                this.setPic = function(pic){
                    if (pic !== null) {
                        this.pic = pic;
                    } else {
                        this.pic = 0;
                    }
                };
            },
            controllerAs: 'gallery'
        };
    });
}());
(function(){

    var app = angular.module('store-panel', []);

    app.controller('ProductController', ['$scope', 'productService', function($scope, productService) {
        this.sendToCart = function(product){
            var productNew = product;
            var alreadyInCart = productService.getProducts();
            var existInCart = jQuery.inArray(productNew, alreadyInCart);

            function checkExist() {
                if (existInCart === -1 ){
                    productService.addProduct(productNew);
                }
            }
            checkExist();
            console.log(alreadyInCart);

        };
    }]);

    app.directive('productPanel', function () {
        return{
            restrict: 'A',
            templateUrl: 'layout/product-panel.html',
            controller: function () {
                this.tab = 1;
                this.selectTab = function(setTab) {
                    this.tab = setTab;
                };
                this.isSet = function (checkTab) {
                    return this.tab === checkTab;
                };
            },
            controllerAs: 'panel'
        };
    });

    app.directive('productDescription', function(){
        return {
            restrict: 'E',
            templateUrl: 'layout/product-description.html'
        };
    });

    app.directive('productSpecs', function () {
        return{
            restrict: 'E',
            templateUrl: 'layout/product-specs.html'
        };
    });

    app.directive('productReview', function () {
        return{
            restrict: 'E',
            templateUrl: 'layout/product-review.html',
            controller: function () {
                this.review = {};
                this.addReview = function(product){
                    this.review.createdOn = Date.now();
                    product.reviews.push(this.review);
                    this.review = {};
                };
            },
            controllerAs: 'reviewCtrl'
        };
    });

    app.filter('sumOfValue', function () {
        return function (data, key) {
            if (typeof (data) === 'undefined' && typeof (key) === 'undefined') {
                return 0;
            }
            var sum = 0;
            for (var i = 0; i < data.length; i++) {
                sum = sum + data[i][key];
            }
            return sum;
        }
    });
}());